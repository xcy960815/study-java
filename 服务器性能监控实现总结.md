# 服务器性能监控功能实现总结

## 功能概述
实现了一个实时服务器性能监控系统，可以监控 CPU、内存、JVM、磁盘等系统资源的使用情况，并通过 WebSocket 实时推送数据到前端展示。

## 技术栈
- **后端**: Spring Boot + OSHI + WebSocket (STOMP)
- **前端**: Vue 3 + ECharts + SockJS + STOMP.js

## 实现步骤

### 一、后端实现

#### 1. 添加依赖 (pom.xml)
```xml
<!-- OSHI 系统监控 -->
<dependency>
    <groupId>com.github.oshi</groupId>
    <artifactId>oshi-core</artifactId>
    <version>6.4.6</version>
</dependency>

<!-- WebSocket 支持 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-websocket</artifactId>
</dependency>
```

#### 2. 创建数据模型
- `ServerInfoVo.java` - 服务器信息 VO，包含：
  - CpuInfo: CPU 核心数、使用率、型号
  - MemoryInfo: 总内存、已用内存、使用率
  - JvmInfo: JVM 内存、版本、启动时间、运行时长
  - DiskInfo: 磁盘总空间、已用空间、使用率
  - SysInfo: 操作系统、架构、主机名、IP

#### 3. 创建服务层
- `ServerMonitorService.java` - 系统监控服务
  - 使用 OSHI 库获取系统信息
  - 支持获取 CPU、内存、JVM、磁盘、系统信息
  - 提供数据格式化和单位转换

#### 4. 配置 WebSocket
- `WebSocketConfig.java` - WebSocket 配置类
  - 启用 STOMP 协议
  - 配置 WebSocket 端点: `/ws/server-monitor`
  - 启用 SockJS 支持
  - 配置消息代理: `/topic`

#### 5. 创建控制器
- `ServerMonitorController.java` - 监控控制器
  - `GET /monitor/server/info` - 获取服务器信息（单次请求）
  - `POST /monitor/server/start` - 开始推送监控数据
  - `POST /monitor/server/stop` - 停止推送监控数据
  - 使用定时任务每 3 秒推送一次数据到 `/topic/server-monitor`

### 二、前端实现

#### 1. 安装依赖
```bash
pnpm add echarts sockjs-client @stomp/stompjs @types/sockjs-client -D
```

#### 2. 创建 API 接口
- `src/apis/server-monitor.ts` - 定义类型和 API 函数
  - `getServerInfo()` - 获取服务器信息
  - `startServerMonitor()` - 开始监控
  - `stopServerMonitor()` - 停止监控

#### 3. 创建 WebSocket 工具类
- `src/utils/websocket.ts` - WebSocket 客户端封装
  - 基于 STOMP 协议
  - 支持自动重连
  - 提供连接、断开、订阅功能

#### 4. 创建监控页面
- `src/views/monitor/server/index.vue` - 服务器监控页面
  - **系统信息卡片**: 展示操作系统、CPU 型号、JVM 版本等基础信息
  - **4个监控图表**:
    - CPU 仪表盘 (Gauge Chart)
    - 内存仪表盘 (Gauge Chart)
    - JVM 饼图 (Pie Chart)
    - 磁盘饼图 (Pie Chart)
  - 支持开始/停止监控
  - 实时连接状态显示
  - 响应式布局

#### 5. 配置路由
- `src/router/routes.ts` - 添加监控路由
  - 路径: `/monitor/server`
  - 菜单名称: 服务监控
  - 图标: TrendTwo (icon-park)

## 功能特点

### 1. 实时监控
- 通过 WebSocket 实现数据实时推送
- 默认每 3 秒更新一次数据
- 前端图表自动刷新

### 2. 可视化展示
- 使用 ECharts 绘制精美图表
- 仪表盘展示 CPU 和内存使用率
- 饼图展示 JVM 和磁盘使用情况
- 支持动画效果

### 3. 交互控制
- 支持手动开始/停止监控
- 显示实时连接状态
- 自动重连机制
- 组件卸载时自动断开连接

### 4. 美观设计
- 渐变色卡片头部
- 悬停效果
- 响应式布局
- 图标统一使用 icon-park 库

## 使用方法

### 1. 启动后端
```bash
cd study-java
mvn spring-boot:run
```

### 2. 启动前端
```bash
cd study-java-web
pnpm dev
```

### 3. 访问监控页面
1. 登录系统
2. 点击左侧菜单 "系统监控 -> 服务监控"
3. 点击"开始监控"按钮
4. 查看实时数据更新

## 文件清单

### 后端文件
- `pom.xml` - Maven 依赖配置
- `src/main/java/com/studyjava/domain/vo/ServerInfoVo.java` - 数据模型
- `src/main/java/com/studyjava/service/ServerMonitorService.java` - 监控服务
- `src/main/java/com/studyjava/config/WebSocketConfig.java` - WebSocket 配置
- `src/main/java/com/studyjava/controller/monitor/ServerMonitorController.java` - 控制器

### 前端文件
- `package.json` - npm 依赖配置
- `src/apis/server-monitor.ts` - API 接口
- `src/utils/websocket.ts` - WebSocket 工具类
- `src/views/monitor/server/index.vue` - 监控页面
- `src/router/routes.ts` - 路由配置

## 扩展建议

1. **历史数据**: 可以添加数据库存储历史监控数据，支持查看历史趋势
2. **告警功能**: 当 CPU、内存超过阈值时发送告警通知
3. **多服务器**: 支持监控多台服务器，可以切换查看
4. **更多指标**: 增加网络流量、线程数、GC 情况等监控指标
5. **数据导出**: 支持导出监控数据为 Excel 或 CSV

## 注意事项

1. **性能影响**: OSHI 获取系统信息会有一定开销，建议推送间隔不要太短
2. **浏览器兼容**: 使用了 WebSocket，需要现代浏览器支持
3. **连接管理**: 页面关闭或刷新时会自动断开 WebSocket 连接
4. **权限控制**: 建议添加权限验证，只允许管理员访问

## 测试要点

- [ ] 页面加载时能正确显示服务器信息
- [ ] 点击"开始监控"后能成功建立 WebSocket 连接
- [ ] 图表能实时更新数据
- [ ] 点击"停止监控"后能正常断开连接
- [ ] 页面刷新或关闭时能释放资源
- [ ] 响应式布局在不同屏幕尺寸下显示正常
