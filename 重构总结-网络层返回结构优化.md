# 网络层返回结构优化 - 后端重构总结

## 1. 核心变更概述

本次重构彻底移除了旧有的 `ResponseResult` (`{code, msg, data}`) 包装器，采用了标准的 RESTful 风格。

| 特性 | 旧版 (Old) | **新版 (New)** |
| :--- | :--- | :--- |
| **HTTP 状态码** | 无论成功失败通常都是 `200` | **成功 `200`**，**失败 `4xx/5xx`** (如 400, 401, 500) |
| **成功响应体** | `{ "code": 200, "msg": "...", "data": { ... } }` | **直接返回业务数据** (如 `{ ... }` 或 `true` 或 `[...]`) |
| **错误响应体** | `{ "code": 400, "msg": "错误信息", "data": null }` | **`{ "code": 400, "message": "错误信息", "path": "...", "timestamp": "..." }`** |
| **分页响应** | `{ "code": 200, "data": [...], "total": 100 }` (结构可能不统一) | **`{ "data": [...], "total": 100 }`** (统一使用 `PageResult`) |
| **认证失败** | HTTP 200 +JSON | **HTTP 401 Unauthorized** + Error JSON |

## 2. 详细改动

### 2.1 成功响应 (Success Response)
所有 Controller 方法不再返回 `ResponseResult<T>`，而是直接返回 `T`。

*   **单体对象**：直接返回 JSON 对象。
    *   例：`/login` -> `{ "token": "...", "userInfo": ... }`
*   **基本类型**：直接返回基本类型值。
    *   例：`/user/insertUser` -> `true`
    *   例：`/captcha` -> `"data:image/jpeg;base64,..."`
*   **分页列表**：使用新的 `PageResult` 结构。
    *   例：`/user/getUserList` -> `{ "data": [...], "total": 100 }`

### 2.2 错误响应 (Error Response)
所有异常（业务异常、参数校验异常、系统异常）统一由 `GlobalExceptionHandler` 处理，返回语义化的 HTTP 状态码和标准错误体。

*   **结构**：
    ```json
    {
      "code": 400,          // 或 500, 401
      "message": "错误描述",
      "path": "/api/path",
      "timestamp": "2023-10-27T10:00:00"
    }
    ```
*   **状态码**：
    *   `400 Bad Request`: 参数校验失败、业务逻辑错误 (StudyJavaException)
    *   `401 Unauthorized`: 未登录、Token 过期
    *   `500 Internal Server Error`: 系统未知异常

### 2.3 认证拦截 (Auth Interceptor)
`AuthInterceptorComponent` 在拦截到未登录或 Token 过期请求时，不再返回 200 OK，而是：
*   **状态码**：`401 Unauthorized`
*   **响应体**：标准错误响应 JSON (同上)

## 3. 涉及文件与类

### 3.1 新增/修改的核心类
*   `src/main/java/com/studyjava/utils/PageResult.java`: 新的分页结果封装。
*   `src/main/java/com/studyjava/utils/ErrorResponse.java`: 新的错误响应封装。
*   `src/main/java/com/studyjava/exception/GlobalExceptionHandler.java`: 更新为返回 ResponseEntity<ErrorResponse>。
*   `src/main/java/com/studyjava/component/AuthInterceptorComponent.java`: 更新为返回 401 和 ErrorResponse。

### 3.2 已删除的类
*   `src/main/java/com/studyjava/utils/ResponseResult.java`
*   `src/main/java/com/studyjava/utils/ResponseListResult.java`
*   `src/main/java/com/studyjava/utils/ResponseGenerator.java`
*   `src/main/java/com/studyjava/domain/enums/ResponseResultEnum.java`

## 4. 前端适配建议 (Frontend Adaptation)

前端 HTTP 请求库（如 Axios）需要做如下调整：

1.  **响应拦截器 (Response Interceptor)**：
    *   **移除**对 `res.code === 200` 的判断。
    *   **直接返回** `response.data` 作为业务数据。
    *   **分页接口**：注意数据结构变为 `{ data, total }`。

2.  **错误拦截器 (Error Interceptor)**：
    *   监听 `error.response.status`。
    *   **401**: 跳转登录或刷新 Token。
    *   **400/500**: 弹出 `error.response.data.message` 提示用户。

